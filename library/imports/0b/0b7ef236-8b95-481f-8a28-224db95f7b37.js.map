{"version":3,"sources":["../../../../../assets/src/room/assets/src/room/RoomScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/src/room","sourcesContent":["import { Board } from \"./Board\";\nimport { DIRECTION, PLAYER_ROLE } from \"../Constants\";\nimport { HugPanel } from \"./HugPanel\";\nimport { Timer } from \"./Timer\";\nimport { OverPanel } from \"./OverPanel\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport class RoomScene extends cc.Component {\n    \n    @property(Board)\n    public board: Board = null;\n    @property(HugPanel)\n    private hugPanel: HugPanel = null;\n    @property(Timer)\n    private timer: Timer = null;\n    @property(cc.Label)\n    private player1ScoreLabel: cc.Label = null;\n    @property(cc.Label)\n    private player2ScoreLabel: cc.Label = null;\n    @property(OverPanel)\n    private overPanel: OverPanel = null;\n\n    private player1Score: number = 0;\n    private player2Score: number = 0;\n    private round: number = 0;\n\n    protected start() {\n        this.board.init(this);\n        this.hugPanel.init(this);\n        cc.director.getCollisionManager().enabled = true;\n        // cc.director.getCollisionManager().enabledDebugDraw = true;\n        this.addListeners();\n        this.newGame();\n    }\n\n    private newGame() {\n        this.timer.reset(60, -1, 0, this.onTimerOver.bind(this));\n        this.timer.run();\n        this.round++;\n        this.board.activePlayers(this.round);\n    }\n\n    private onTimerOver() {\n        this.board.pausePlayers();\n        cc.log('攻守交换');\n        if (this.round >= 2) {\n            this.overGame();\n        } else {\n            this.node.getChildByName('ExchangeRole').getComponent(cc.Animation).play();\n            this.newGame();\n        }\n    }\n\n    private overGame() {\n        if (this.player1Score > this.player2Score) {\n            this.overPanel.show(true, this.player1Score, this.player2Score);     \n        } else {\n            this.overPanel.show(false, this.player2Score, this.player1Score);   \n        }\n        setTimeout(() => {\n            cc.director.loadScene('loading');\n        }, 10000);\n    }\n\n    onHug() {\n        cc.log('show hug panel');\n        this.board.pausePlayers();\n        this.timer.pause();\n        this.hugPanel.show();\n    }\n\n    onHugOver(score) {\n        cc.log(score);\n        if (this.board.player1.role === PLAYER_ROLE.ATTACK) {\n            this.player1Score += score;\n            this.player1ScoreLabel.string = this.player1Score + '';\n        } else {\n            this.player2Score += score;\n            this.player2ScoreLabel.string = this.player2Score + '';\n        }\n        this.timer.resume();\n        this.board.activePlayers(this.round);\n    }\n\n    private onKeyDown(event) {\n        switch(event.keyCode) {\n            case cc.KEY.w:\n                this.board.movePlayer1(DIRECTION.UP);\n                break;\n            case cc.KEY.a:\n                this.board.movePlayer1(DIRECTION.LEFT);\n                break;\n            case cc.KEY.s:\n                this.board.movePlayer1(DIRECTION.DOWN);\n                break;\n            case cc.KEY.d:\n                this.board.movePlayer1(DIRECTION.RIGHT);\n                break;\n            case cc.KEY.space:\n                this.board.skillPlayer1();\n                break;\n            case cc.KEY.up:\n                this.board.movePlayer2(DIRECTION.UP);\n                break;\n            case cc.KEY.left:\n                this.board.movePlayer2(DIRECTION.LEFT);\n                break;\n            case cc.KEY.down:\n                this.board.movePlayer2(DIRECTION.DOWN);\n                break;\n            case cc.KEY.right:\n                this.board.movePlayer2(DIRECTION.RIGHT);\n                break;\n            case cc.KEY.enter:\n                this.board.skillPlayer2();\n                break;\n            default:\n                break;\n        }\n    }\n\n    private onKeyUp(event) {\n        switch(event.keyCode) {\n            case cc.KEY.w:\n                this.board.tryStopPlayer1(DIRECTION.UP);\n                break;\n            case cc.KEY.a:\n                this.board.tryStopPlayer1(DIRECTION.LEFT);\n                break;\n            case cc.KEY.s:\n                this.board.tryStopPlayer1(DIRECTION.DOWN);\n                break;\n            case cc.KEY.d:\n                this.board.tryStopPlayer1(DIRECTION.RIGHT);\n                break;\n            case cc.KEY.space:\n                // this.board.recoverPlayer1();\n                break;\n            case cc.KEY.up:\n                this.board.tryStopPlayer2(DIRECTION.UP);\n                break;\n            case cc.KEY.left:\n                this.board.tryStopPlayer2(DIRECTION.LEFT);\n                break;\n            case cc.KEY.down:\n                this.board.tryStopPlayer2(DIRECTION.DOWN);\n                break;\n            case cc.KEY.right:\n                this.board.tryStopPlayer2(DIRECTION.RIGHT);\n                break;\n            case cc.KEY.enter:\n                // this.board.recoverPlayer2();\n                break;\n            default:\n                break;\n        }\n    }\n\n    private addListeners() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    private removeListeners() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    protected onDestroy() {\n        this.removeListeners();\n    }\n}"]}